{% extends "base.html" %}

{% block title %}Roles - Team Skills Manager{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">
            Organizational Roles
        </h1>
        <p style="color: var(--text-secondary); font-size: 1.1rem;">
            {{ roles|length }} roles with skill requirements and team assignments
        </p>
    </div>
    <a href="/roles/add" class="btn btn-primary">
        <i class="fas fa-plus-circle"></i> Add New Role
    </a>
</div>

<!-- Search Bar -->
{% if roles %}
<div style="position: relative; margin-bottom: 2rem;">
    <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
    <input 
        type="text" 
        id="roleSearch" 
        placeholder="Search roles by name or description..." 
        class="form-control"
        style="padding-left: 2.5rem;"
    >
</div>

<!-- Roles Table -->
<div class="card" style="padding: 0; overflow: hidden;">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th style="font-size: 1.1rem;">Role Name</th>
                    <th style="font-size: 1.1rem;">Description</th>
                    <th style="font-size: 1.1rem;">Required Skills</th>
                    <th style="font-size: 1.1rem;">Team Members</th>
                    <th style="font-size: 1.1rem;">Actions</th>
                </tr>
            </thead>
            <tbody id="rolesTableBody">
                {% for role in roles %}
                <tr class="role-row" 
                    data-name="{{ role.role_name|lower }}" 
                    data-description="{{ (role.description or '')|lower }}">
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: {% if role.required_skills > 0 %}var(--accent-primary){% else %}var(--text-muted){% endif %};"></div>
                            <strong style="font-size: 1rem;">{{ role.role_name }}</strong>
                        </div>
                    </td>
                    <td style="max-width: 350px;">
                        <p style="color: var(--text-secondary); font-size: 0.9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ role.description or 'â€”' }}
                        </p>
                    </td>
                    <td style="text-align: center;">
                        {% if role.required_skills > 0 %}
                        <span class="badge badge-primary" style="font-family: 'JetBrains Mono', monospace;">
                            {{ role.required_skills }} skill{{ 's' if role.required_skills != 1 else '' }}
                        </span>
                        {% else %}
                        <span style="color: var(--text-muted); font-size: 0.9rem;">None</span>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">
                        {% if role.member_count > 0 %}
                        <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="fas fa-users" style="color: var(--accent-success); font-size: 0.9rem;"></i>
                            <span style="font-weight: 600; font-family: 'JetBrains Mono', monospace; color: var(--accent-success);">
                                {{ role.member_count }}
                            </span>
                        </div>
                        {% else %}
                        <span style="color: var(--text-muted); font-size: 0.9rem;">0</span>
                        {% endif %}
                    </td>
                    <td style="text-align: right;">
                        <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                            <a href="/roles/{{ role.role_id }}" class="btn btn-secondary" style="padding: 0.5rem 0.75rem; font-size: 0.85rem;" title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="/roles/{{ role.role_id }}/edit" class="btn btn-secondary" style="padding: 0.5rem 0.75rem; font-size: 0.85rem;" title="Edit Role">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form method="POST" action="/roles/{{ role.role_id }}/delete" style="display: inline;">
                                <button type="submit" class="btn btn-danger" style="padding: 0.5rem 0.75rem; font-size: 0.85rem;" onclick="return confirm('Delete this role? Members with this role will have their role unassigned.')" title="Delete Role">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- No Results Message -->
<div id="noResults" style="display: none;" class="card" style="text-align: center; padding: 3rem 2rem;">
    <i class="fas fa-search" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem; opacity: 0.3;"></i>
    <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary);">No roles found</h3>
    <p style="color: var(--text-muted);">Try adjusting your search terms</p>
</div>

<!-- Quick Info Card -->
<div class="card" style="margin-top: 2rem; background: linear-gradient(135deg, rgba(0, 217, 255, 0.03), rgba(124, 58, 237, 0.03));">
    <div style="display: flex; align-items: start; gap: 1rem;">
        <i class="fas fa-info-circle" style="color: var(--accent-primary); font-size: 1.5rem; margin-top: 0.25rem;"></i>
        <div>
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">
                About Role Management
            </h3>
            <p style="color: var(--text-secondary); font-size: 0.95rem; line-height: 1.6;">
                Roles define organizational positions with specific skill requirements. Each role can have multiple skill requirements with minimum proficiency levels (1-3). 
                Members can only be assigned to roles if they meet all skill requirements. Click on any role to view details, manage skill requirements, and see assigned members.
            </p>
        </div>
    </div>
</div>

{% else %}
<div class="card" style="text-align: center; padding: 4rem 2rem;">
    <i class="fas fa-user-tag" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem; opacity: 0.3;"></i>
    <h3 style="font-size: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary);">No roles defined</h3>
    <p style="color: var(--text-muted); margin-bottom: 2rem;">Start building your organizational structure by creating roles</p>
    <a href="/roles/add" class="btn btn-primary">
        <i class="fas fa-plus-circle"></i> Create First Role
    </a>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Search functionality
    const searchInput = document.getElementById('roleSearch');
    const roleRows = document.querySelectorAll('.role-row');
    const noResults = document.getElementById('noResults');
    const rolesTable = document.querySelector('.card');

    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            let visibleCount = 0;

            roleRows.forEach(row => {
                const name = row.dataset.name;
                const description = row.dataset.description;

                if (name.includes(searchTerm) || description.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Show/hide no results message
            if (visibleCount === 0) {
                noResults.style.display = 'block';
                rolesTable.style.display = 'none';
            } else {
                noResults.style.display = 'none';
                rolesTable.style.display = 'block';
            }
        });
    }
</script>
{% endblock %}